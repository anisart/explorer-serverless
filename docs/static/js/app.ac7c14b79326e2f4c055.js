webpackJsonp([1],{0:function(t,e){},1:function(t,e){},NHnr:function(t,e,o){"use strict";function r(t){o("kb7T")}function i(t,e){return Math.floor((t+180)/360*Math.pow(2,e))}function n(t,e){return Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e))}function a(t,e){return t/Math.pow(2,e)*360-180}function s(t,e){var o=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)))}function l(t,e,o){return{north:s(e,o),south:s(e+1,o),west:a(t,o),east:a(t+1,o)}}function c(t){o("jUBK")}function u(t){var e=JSON.parse(t),o=[];return e.forEach(function(t){var e=t.split("-");o.push({x:Number(e[0]),y:Number(e[1])})}),o}function d(t){try{if(JSON.parse(t)instanceof Array)return!0}catch(t){}return!1}Object.defineProperty(e,"__esModule",{value:!0});var p=o("/5sW"),v=o("3EgV"),f=o.n(v),m=(o("QCv7"),o("gRE1")),h=o.n(m),g=o("CgZs"),x=o.n(g),k=o("WgY6"),y=o.n(k),_={name:"app",data:function(){return{sideNav:!1,menuItems:[{title:"Upload track",icon:"file_upload",action:"uploadFile"},{title:"Explorer",icon:"widgets",action:"toggleExplorer"},{title:"Compare VV",icon:"compare",action:"compareVv"}]}},methods:{menuItemClicked:function(t){switch(this.sideNav=!1,t){case"uploadFile":this.$refs.fileInput.click();break;case"toggleExplorer":this.$refs.explorerZoom.dialog=!0;break;case"compareVv":this.$refs.compareVv.dialog=!0}},readFile:function(t){var e=(new DOMParser).parseFromString(t,"text/xml"),o=this.$store.getters.track,r=x.a.gpx(e);o?o.features=o.features.concat(r.features):o=r,this.$store.dispatch("setTrack",o)},filePicked:function(t){var e=this,o=t.target.files;h()(o).forEach(function(t){if("zip"!==t.name.split(".").pop()){var o=new FileReader;o.onload=function(){e.readFile(o.result)},o.readAsText(t,"utf8")}else{var r=e;y.a.loadAsync(t).then(function(t){t.forEach(function(t,e){e.async("string").then(r.readFile).catch(console.error)})}).catch(function(e){console.log(t.name+" : "+e)})}})}}},T=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-app",{attrs:{light:""}},[o("v-navigation-drawer",{attrs:{fixed:""},model:{value:t.sideNav,callback:function(e){t.sideNav=e},expression:"sideNav"}},[o("v-list",t._l(t.menuItems,function(e){return o("v-list-tile",{key:e.title,on:{click:function(o){t.menuItemClicked(e.action)}}},[o("v-list-tile-action",[o("v-icon",[t._v(t._s(e.icon))])],1),t._v(" "),o("v-list-tile-content",[o("v-list-tile-title",[t._v(t._s(e.title))])],1)],1)}))],1),t._v(" "),o("v-toolbar",[o("v-toolbar-side-icon",{staticClass:"hidden-sm-and-up",attrs:{light:""},on:{click:function(e){e.stopPropagation(),t.sideNav=!t.sideNav}}}),t._v(" "),o("v-toolbar-title",[t._v("Explorer")]),t._v(" "),o("v-spacer"),t._v(" "),o("v-toolbar-items",{staticClass:"hidden-xs-only"},t._l(t.menuItems,function(e){return o("v-btn",{key:e.title,attrs:{flat:""},on:{click:function(o){t.menuItemClicked(e.action)}}},[o("v-icon",{attrs:{left:"",dark:""}},[t._v(t._s(e.icon))]),t._v("\n        "+t._s(e.title)+"\n      ")],1)}))],1),t._v(" "),o("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"text/xml text/gpx-xml text/gpx application/gpx-xml application/gpx",multiple:""},on:{change:t.filePicked}}),t._v(" "),o("app-explorer-zoom",{ref:"explorerZoom",staticStyle:{display:"none"}}),t._v(" "),o("app-compare-vv",{ref:"compareVv",staticStyle:{display:"none"}}),t._v(" "),o("v-content",{attrs:{fluid:""}},[o("router-view")],1)],1)},b=[],w={render:T,staticRenderFns:b},C=w,F=o("VU/8"),M=r,j=F(_,C,!1,M,null,null),S=j.exports,E=o("/ocq"),I=o("BO1k"),N=o.n(I),Z=o("1e2d"),V=o.n(Z),$=o("+Div"),O=o.n($),P={data:function(){return{map:null,progress:100}},computed:{trackGeojson:function(){return this.$store.getters.track},tracksCount:function(){return this.trackGeojson?this.trackGeojson.features.length:0},explorerZoom:function(){return this.$store.state.explorerZoom},firstTiles:function(){return this.$store.state.firstTiles},secondTiles:function(){return this.$store.state.secondTiles}},watch:{tracksCount:function(){this.map.getSource("track").setData(this.trackGeojson),this.fillExplorerLayer()},explorerZoom:function(){this.fillExplorerLayer()},firstTiles:function(){this.map.getSource("explorer").setData(this.getCompareTiles(this.firstTiles)),this.map.getSource("explorer2").setData(this.getCompareTiles(this.secondTiles))}},methods:{createMap:function(){V.a.accessToken="pk.eyJ1IjoiYW5pc2FydCIsImEiOiJjajluM3Z4YWgyNThjMzJtdmdlYTR4dG02In0.W1X35NjVBiwithy3SaUo8g",this.map=new V.a.Map({container:"map",style:"mapbox://styles/mapbox/streets-v9",center:[43.8052,56.2777],zoom:9,maxZoom:20,minZoom:1}),this.map.addControl(new V.a.NavigationControl),this.map.on("load",this.mapLoaded)},mapLoaded:function(){this.map.addSource("track",{type:"geojson",data:this.trackGeojson}),this.map.addLayer({id:"track",type:"line",source:"track",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#f00","line-width":2}}),this.map.addSource("explorer",{type:"geojson",data:null}),this.map.addLayer({id:"explorer",type:"fill",source:"explorer",paint:{"fill-color":"#0f0","fill-opacity":.3}}),this.map.addSource("explorer2",{type:"geojson",data:null}),this.map.addLayer({id:"explorer2",type:"fill",source:"explorer2",paint:{"fill-color":"#f00","fill-opacity":.3}})},fillExplorerLayer:function(){if(null!==this.trackGeojson){var t=[];this.trackGeojson.features.forEach(function(e){t=t.concat(e.geometry.coordinates)}),this.map.getSource("explorer").setData(this.getTiles(t,Number(this.explorerZoom)))}},getTiles:function(t,e){var o=[];t.forEach(function(t){var r=i(t[0],e),a=n(t[1],e);o.push({x:r,y:a})});var r={},a=[],s=!0,c=!1,u=void 0;try{for(var d,p=N()(o);!(s=(d=p.next()).done);s=!0){var v=d.value,f=v.x+"-"+v.y;if(!r[f]){r[f]=!0;var m=l(v.x,v.y,e),h={polygon:[[[m.west,m.north],[m.east,m.north],[m.east,m.south],[m.west,m.south],[m.west,m.north]]]};a.push(h)}}}catch(t){c=!0,u=t}finally{try{!s&&p.return&&p.return()}finally{if(c)throw u}}return O.a.parse(a,{Polygon:"polygon"})},getCompareTiles:function(t){var e=[];return t.forEach(function(t){var o=l(t.x,t.y,14),r={polygon:[[[o.west,o.north],[o.east,o.north],[o.east,o.south],[o.west,o.south],[o.west,o.north]]]};e.push(r)}),O.a.parse(e,{Polygon:"polygon"})}},mounted:function(){this.createMap()}},D=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"map"}},[o("v-progress-linear",{staticClass:"ma-0",model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}})],1)},G=[],J={render:D,staticRenderFns:G},L=J,R=o("VU/8"),U=c,q=R(P,L,!1,U,"data-v-d4fd618e",null),z=q.exports;p.a.use(E.a);var A=new E.a({routes:[{path:"/",name:"Map",component:z}]}),B=o("NYxO");p.a.use(B.a);var W=new B.a.Store({state:{track:null,explorerZoom:"14",firstTiles:null,secondTiles:null},mutations:{setTrack:function(t,e){t.track=e},setExplorerZoom:function(t,e){t.explorerZoom=e},setFirstTiles:function(t,e){t.firstTiles=e},setSecondTiles:function(t,e){t.secondTiles=e}},actions:{setTrack:function(t,e){(0,t.commit)("setTrack",e)},setExplorerZoom:function(t,e){(0,t.commit)("setExplorerZoom",e)},setFirstTiles:function(t,e){(0,t.commit)("setFirstTiles",e)},setSecondTiles:function(t,e){(0,t.commit)("setSecondTiles",e)}},getters:{track:function(t){return t.track},explorerZoom:function(t){return t.explorerZoom},firstTiles:function(t){return t.firstTiles},secondTiles:function(t){return t.secondTiles}}}),Y={data:function(){return{dialog:!1}},computed:{dialogValue:{get:function(){return this.$store.state.explorerZoom},set:function(t){this.$store.commit("setExplorerZoom",t)}}}},H=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-layout",{attrs:{row:"","justify-center":""}},[o("v-dialog",{attrs:{scrollable:"","max-width":"300px"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[o("v-btn",{attrs:{slot:"activator",color:"primary",dark:""},slot:"activator"},[t._v("Open Dialog")]),t._v(" "),o("v-card",[o("v-card-title",{staticClass:"headline"},[t._v("Select explorer tile size")]),t._v(" "),o("v-divider"),t._v(" "),o("v-card-text",{staticStyle:{height:"300px"}},[o("v-radio-group",{attrs:{column:""},model:{value:t.dialogValue,callback:function(e){t.dialogValue=e},expression:"dialogValue"}},[o("v-radio",{attrs:{label:"4 km",value:"12"}}),t._v(" "),o("v-radio",{attrs:{label:"2 km",value:"13"}}),t._v(" "),o("v-radio",{attrs:{label:"1 km",value:"14"}}),t._v(" "),o("v-radio",{attrs:{label:"500 m",value:"15"}}),t._v(" "),o("v-radio",{attrs:{label:"250 m",value:"16"}})],1)],1),t._v(" "),o("v-divider"),t._v(" "),o("v-card-actions",[o("v-spacer"),t._v(" "),o("v-btn",{attrs:{color:"blue darken-1",flat:""},nativeOn:{click:function(e){t.dialog=!1}}},[t._v("Close")])],1)],1)],1)],1)},K=[],Q={render:H,staticRenderFns:K},X=Q,tt=o("VU/8"),et=tt(Y,X,!1,null,null,null),ot=et.exports,rt={data:function(){return{dialog:!1,loader:null,loading:!1,firstTiles:"",secondTiles:"",rules:{required:function(t){return!!t||"Required."},json:function(t){return d(t)||"Invalid JSON array"}}}},computed:{invalidFields:function(){return!d(this.firstTiles)||!d(this.secondTiles)}},methods:{compareClicked:function(){this.loading=!0,this.$store.commit("setFirstTiles",u(this.firstTiles)),this.$store.commit("setSecondTiles",u(this.secondTiles)),this.loading=!1,this.dialog=!1}}},it=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-layout",{attrs:{row:"","justify-center":""}},[o("v-dialog",{attrs:{scrollable:"","max-width":"400px"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[o("v-btn",{attrs:{slot:"activator",color:"primary",dark:""},slot:"activator"},[t._v("Open Dialog")]),t._v(" "),o("v-card",[o("v-card-title",{staticClass:"headline"},[t._v("\n        Input explorer tiles strings\n      ")]),t._v(" "),o("v-divider"),t._v(" "),o("v-card-text",{staticStyle:{height:"300px"}},[o("div",[t._v("\n          Output of "),o("pre",[t._v("JSON.stringify(Object.keys(window.explorerTiles))")]),t._v(" on VV Activities page.\n        ")]),t._v(" "),o("v-text-field",{attrs:{label:"First user tiles",hint:'["10216-5093","10216-5092",...,"10217-5093"]',"persistent-hint":"true",rules:[t.rules.required,t.rules.json],required:""},model:{value:t.firstTiles,callback:function(e){t.firstTiles=e},expression:"firstTiles"}}),t._v(" "),o("v-text-field",{attrs:{label:"Second user tiles",hint:'["10216-5093","10216-5092",...,"10217-5093"]',"persistent-hint":"true",rules:[t.rules.required,t.rules.json],required:""},model:{value:t.secondTiles,callback:function(e){t.secondTiles=e},expression:"secondTiles"}})],1),t._v(" "),o("v-divider"),t._v(" "),o("v-card-actions",[o("v-spacer"),t._v(" "),o("v-btn",{attrs:{color:"blue darken-1",flat:""},nativeOn:{click:function(e){t.dialog=!1}}},[t._v("\n            Close\n          ")]),t._v(" "),o("v-btn",{attrs:{color:"blue darken-1",flat:"",loading:t.loading,disabled:t.loading||t.invalidFields},nativeOn:{click:function(e){t.compareClicked(e)}}},[t._v("\n            Compare\n          ")])],1)],1)],1)],1)},nt=[],at={render:it,staticRenderFns:nt},st=at,lt=o("VU/8"),ct=lt(rt,st,!1,null,null,null),ut=ct.exports;p.a.component("app-explorer-zoom",ot),p.a.component("app-compare-vv",ut),p.a.use(f.a,{theme:{primary:"#ee44aa",secondary:"#424242",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#4CAF50",warning:"#FFC107"}}),p.a.config.productionTip=!1,new p.a({el:"#app",router:A,store:W,render:function(t){return t(S)}})},QCv7:function(t,e){},jUBK:function(t,e){},kb7T:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.ac7c14b79326e2f4c055.js.map